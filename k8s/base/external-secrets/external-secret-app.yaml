apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: wcd-app-secrets
  namespace: wcd-production
  labels:
    app.kubernetes.io/name: wcd-secrets
    app.kubernetes.io/part-of: wcd-system
spec:
  # How often to sync secrets from GCP
  refreshInterval: 1h

  # Reference to the SecretStore
  secretStoreRef:
    name: gcp-secret-manager
    kind: SecretStore

  # Target Kubernetes secret to create
  target:
    name: wcd-app-secrets
    creationPolicy: Owner
    template:
      type: Opaque
      metadata:
        labels:
          app.kubernetes.io/name: wcd-secrets
          app.kubernetes.io/part-of: wcd-system
          managed-by: external-secrets

  # Data to fetch from GCP Secret Manager
  data:
    # API Key for frontend communication
    - secretKey: WCD_API_KEY
      remoteRef:
        key: wcd-api-key
        version: latest

    # Redis password
    - secretKey: REDIS_PASSWORD
      remoteRef:
        key: wcd-redis-password
        version: latest

    # JWT Secret for authentication
    - secretKey: JWT_SECRET
      remoteRef:
        key: wcd-jwt-secret
        version: latest
